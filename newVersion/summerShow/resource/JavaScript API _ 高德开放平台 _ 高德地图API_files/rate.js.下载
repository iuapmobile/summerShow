!function(){function t(){n(),$("#rate").size()>0&&b.getInfo().done(function(t){var n=t.data?t.data.star:0;e(n)}).fail(function(){e(0)})}function n(){c.find(".submit").on("click",function(){var t=$(this),n=c.find("textarea").val().trim();return 0===n.length?void s("内容不能为空"):(g.content=n,t.attr("disabled",!0).addClass("loading").html("提交中..."),void b.setRaty().done(function(t){0===t.code?(m=d.raty("score"),r(),toastr.success("提交成功, 感谢您的反馈!")):s(t.msg)}).fail(function(){s()}).always(function(){t.removeAttr("disabled").removeClass("loading").html("提交")}))}),$(".feedback").on("click",function(t){t.preventDefault(),m=d.raty("score"),o(function(){a(),p=!0,u.modal("show")})}),$(".feedback-item").on("click",function(t){t.preventDefault(),g.type=$(this).attr("type"),p=!0,u.modal("hide"),i()}),$("#raty-content .pro").on("click",function(t){t.preventDefault(),$(this).parent().toggleClass("not")}),f.on("click",function(){v.close(),c.modal("hide")}),c.add(u).on("hidden.bs.modal",function(){if(!y){if(p)return void(p=!1);p=!1,m?d.raty("score",m):d.raty("cancel")}}),c.on("shown.bs.modal",function(){v.load(function(){v.render({target:h,excludeElements:".modal, .modal-backdrop"}),v.onOpen=function(){y=!0,c.modal("hide")},v.onDone=function(){y=!1,c.modal("show")},v.onBeforeRender=function(){c.find(".submit").attr("disabled",!0).addClass("loading").html("加载中...")},v.onAfterRender=function(){c.find(".submit").removeAttr("disabled").removeClass("loading").html("提交")}})})}function o(t,n){window.isLogin?t():passport.show({},function(){oLoginMod.login(function(){b.getInfo().done(function(t){var o=t.data?t.data.star:0;n||d.raty("score",o)}).fail(function(){d.raty("score",0)}).always(function(){t(!0)})})})}function e(t){d.raty({score:t,path:w,hints:["文档根本没法看","文档水平很差","文档水平一般","文档不错","文档很棒"],target:"#rate-description",click:function(t){o(function(n){var o=d.raty("score");(n||t!==o)&&(a(),g.star=t,t<=3?(m=d.raty("score")||0,u.modal("show")):b.setRaty().done(function(t){0===t.code?toastr.success("提交成功, 感谢您的反馈!"):s(t.msg)}).fail(function(){s()}))},!0)},mouseover:function(){$("#rate-description").addClass("hover")},mouseout:function(){$("#rate-description").removeClass("hover")}}),d.find("img").removeAttr("title")}function a(){g={postId:l}}function i(){c.find("textarea").val(""),p=!1,c.modal("show")}function r(){v.load(function(){v.close()}),c.modal("hide")}function s(t){toastr.error(t||"评价失败,请重试!")}var d=$("#rate"),c=$("#raty-content"),u=$("#raty-type"),l=$("body").data("id"),f=c.find(".cancel"),m=0,p=!1,h=document.getElementById("feedback-canvas-container"),v=window.screenshot||{},y=!1;toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-center",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"3000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};var g={postId:l},w=$("#rate-path").attr("src");w=w.slice(0,w.lastIndexOf("/")+1)+"images/";var b={getInfo:function(){return $.ajax({method:"GET",url:"/dev/home/get-raty-info",dataType:"json",timeout:3e3,data:{postId:l}})},setRaty:function(){if(0===v.getMarkCount()||c.find(".modal-body").hasClass("not"))return $.ajax({method:"POST",url:"/dev/home/post-raty",dataType:"json",timeout:8e3,data:g});var t=new $.Deferred,n=new FormData;return v.getData(function(o){for(var e in g)n.append(e,g[e]);n.append("raty_image_upload",o,"raty_image_upload.png"),$.ajax({method:"POST",url:"/dev/home/post-raty",dataType:"json",timeout:8e3,data:n,processData:!1,contentType:!1}).success(function(n){t.resolve(n)}).fail(function(n){t.reject(n)})}),t.promise()}};$(function(){t()})}();